# [LazyAud.io](http://lazyaud.io/) macOS 桌面应用页面需求文档

## 1. 应用架构

### 1.1 窗口结构

- **主窗口**：固定大小，最小化到 Dock
- **侧边栏导航**：左侧固定导航栏
- **内容区域**：右侧动态内容展示
- **状态栏**：底部显示应用状态

### 1.2 导航结构

```
├── 录制 (Record)
├── 历史 (History)
└── 设置 (Settings)

```

## 2. 页面详细设计

### 2.1 录制页面 (Record Page)

### 2.1.1 页面布局

```
┌─────────────────────────────────────────┐
│ 🎙️ 新建录制                              │
├─────────────────────────────────────────┤
│ 音频源选择                                │
│ ○ 系统音频  ○ 应用音频                    │
│ ☐ 同时录制麦克风                          │
├─────────────────────────────────────────┤
│ 应用选择 (当选择应用音频时显示)             │
│ [下拉菜单: 选择应用...]                    │
├─────────────────────────────────────────┤
│ 录制标题                                  │
│ [输入框: 会议记录 - 2024.01.15]           │
├─────────────────────────────────────────┤
│ 保存位置                                  │
│ [~/Documents/LazyAud] [选择文件夹...]     │
├─────────────────────────────────────────┤
│           [🔴 开始录制]                   │
└─────────────────────────────────────────┘

```

### 2.1.2 功能组件

- **音频源选择器**
    - 单选按钮：系统音频/应用音频
    - 复选框：同时录制麦克风
    - 实时音频电平显示
- **应用选择器** (条件显示)
    - 下拉菜单显示正在运行的音频应用
    - 应用图标 + 名称显示
    - 自动刷新应用列表
- **录制配置**
    - 标题输入框（默认：录制 + 时间戳）
    - 保存路径选择器
    - 音频格式快速选择
- **录制控制**
    - 开始录制按钮（大号，醒目）
    - 权限检查提示

### 2.1.3 状态变化

**录制前状态**

- 显示配置选项
- 开始录制按钮可用
- 权限状态检查

**录制中状态**

```
┌─────────────────────────────────────────┐
│ 🔴 正在录制 - 会议记录                    │
├─────────────────────────────────────────┤
│ 录制时长: 00:05:32                       │
│ 文件大小: 12.3 MB                        │
├─────────────────────────────────────────┤
│ 音频波形 ████▌░░░░░░                     │
│ 系统音频: ████████░░                     │
│ 麦克风: ██░░░░░░░░░░                      │
├─────────────────────────────────────────┤
│ [⏸️ 暂停] [⏹️ 停止] [⚙️ 设置]             │
├─────────────────────────────────────────┤
│ 📝 实时转录                              │
│ 状态: 🟢 转录中 | 模型: whisper-base     │
├─────────────────────────────────────────┤
│ 转录文本区域                              │
│ ┌─────────────────────────────────────┐ │
│ │ [00:01:23] 今天我们来讨论一下...      │ │
│ │ [00:01:45] 关于这个项目的进展情况     │ │
│ │ [00:02:10] 我认为我们需要...          │ │
│ │ [00:02:30] 是的，我同意你的观点       │ │
│ │                                     │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ AI 操作栏                                │
│ [📋 摘要] [✅ 任务] [🌐 翻译] [❓ 提问]    │
└─────────────────────────────────────────┘

```

### 2.1.4 转录功能

- **实时转录状态**
    - 转录状态指示器（绿色=活跃，灰色=停止）
    - 当前使用模型显示
    - 转录置信度（可选）
- **转录文本区域**
    - 滚动文本显示区域
    - 时间戳标记
    - 文本选择功能
    - 右键菜单（复制、AI操作）
    - 搜索功能
- **AI 操作栏**
    - 摘要按钮：生成内容摘要
    - 任务按钮：提取待办事项
    - 翻译按钮：翻译选中文本
    - 提问按钮：基于选中内容提问

### 2.1.5 交互行为

- **录制控制**
    - 开始/暂停/停止录制
    - 实时显示录制状态和音频波形
- **转录交互**
    - 文本选择：点击拖拽选择文本行
    - 右键菜单：复制、AI处理、添加标记
    - 实时滚动：新内容自动滚动到底部
    - AI 结果显示：弹出窗口或侧边栏显示
- **AI 操作**
    - 实时处理选中的转录文本
    - 支持多种 AI 功能（摘要、任务提取、翻译、问答）
    - 结果实时显示在侧边栏或弹出窗口

### 2.2 历史页面 (History Page)

### 2.2.1 页面布局

```
┌─────────────────────────────────────────┐
│ 📚 录制历史                              │
├─────────────────────────────────────────┤
│ [搜索框] [筛选▼] [排序▼] [导出]          │
├─────────────────────────────────────────┤
│ 录制列表                                  │
│ ┌─────────────────────────────────────┐ │
│ │ 📁 会议记录 - 2024.01.15             │ │
│ │    2024-01-15 14:30 | 1h 23m | 45MB │ │
│ │    转录: 完成 | AI: 已处理            │ │
│ │    [▶️ 播放] [📝 查看] [🗑️ 删除]      │ │
│ ├─────────────────────────────────────┤ │
│ │ 📁 培训视频录制                      │ │
│ │    2024-01-14 09:15 | 2h 15m | 78MB │ │
│ │    转录: 完成 | AI: 未处理            │ │
│ │    [▶️ 播放] [📝 查看] [🗑️ 删除]      │ │
│ └─────────────────────────────────────┘ │
└─────────────────────────────────────────┘

```

### 2.2.2 功能组件

- **搜索和筛选**
    - 搜索框：按标题、内容搜索
    - 筛选器：按日期、时长、状态筛选
    - 排序：按时间、时长、大小排序
- **录制列表项**
    - 录制标题（可编辑）
    - 录制时间和时长
    - 文件大小
    - 转录状态
    - AI 处理状态
    - 操作按钮
- **操作按钮**
    - 播放按钮：播放音频
    - 查看按钮：查看转录和AI结果
    - 删除按钮：删除录制

### 2.2.3 详情视图

点击查看按钮后的详情页面：

```
┌─────────────────────────────────────────┐
│ ← 返回 | 会议记录 - 2024.01.15           │
├─────────────────────────────────────────┤
│ 音频播放器 ▶️ ────●──── 01:23 / 01:23:45 │
├─────────────────────────────────────────┤
│ 标签页: [📝 转录] [📋 摘要] [✅ 任务]      │
├─────────────────────────────────────────┤
│ 内容显示区域                              │
│ ┌─────────────────────────────────────┐ │
│ │ [00:01:23] 今天我们来讨论一下...      │ │
│ │ [00:01:45] 关于这个项目的进展情况     │ │
│ │ [00:02:10] 我认为我们需要...          │ │
│ │ [00:02:30] 是的，我同意你的观点       │ │
│ │                                     │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ AI 操作栏                                │
│ [📋 摘要] [✅ 任务] [🌐 翻译] [❓ 提问]    │
├─────────────────────────────────────────┤
│ [导出] [编辑] [重新AI处理]                │
└─────────────────────────────────────────┘

```

### 2.2.4 详情页功能

- **音频播放**
    - 播放控制（播放/暂停、进度条、音量）
    - 播放速度调节
    - 音频波形显示
- **内容查看**
    - 转录文本（带时间戳）
    - AI 生成摘要
    - 任务列表
    - 支持文本搜索和选择
- **AI 操作**
    - 对选中文本进行 AI 处理
    - 支持摘要、任务提取、翻译、问答
    - 可以重新处理整个内容
- **导出选项**
    - 导出音频文件
    - 导出转录文本
    - 导出 AI 处理结果

### 2.3 设置页面 (Settings Page)

### 2.4.1 页面布局

```
┌─────────────────────────────────────────┐
│ ⚙️ 设置                                  │
├─────────────────────────────────────────┤
│ 侧边栏                    │ 设置内容区域   │
│ • 通用设置                │               │
│ • 音频设置                │               │
│ • 转录设置                │               │
│ • AI 设置                 │               │
│ • 快捷键                  │               │
│ • 关于                    │               │
└─────────────────────────────────────────┘

```

### 2.4.2 通用设置

```
┌─────────────────────────────────────────┐
│ 通用设置                                  │
├─────────────────────────────────────────┤
│ 默认保存位置                              │
│ [~/Documents/LazyAud] [更改...]          │
├─────────────────────────────────────────┤
│ 启动选项                                  │
│ ☐ 开机自启动                             │
│ ☐ 启动时最小化到状态栏                    │
├─────────────────────────────────────────┤
│ 界面设置                                  │
│ 主题: [○ 跟随系统 ○ 浅色 ○ 深色]         │
│ 语言: [简体中文 ▼]                       │
└─────────────────────────────────────────┘

```

### 2.4.3 音频设置

```
┌─────────────────────────────────────────┐
│ 音频设置                                  │
├─────────────────────────────────────────┤
│ 录制格式                                  │
│ 格式: [WAV ▼] 质量: [高质量 ▼]           │
│ 采样率: [44100 Hz ▼]                    │
├─────────────────────────────────────────┤
│ 麦克风设置                                │
│ 默认麦克风: [内置麦克风 ▼]                │
│ 增益: ────●──── 自动增益控制 ☑️           │
├─────────────────────────────────────────┤
│ 系统音频                                  │
│ 音量监控: ☑️ 显示音频波形                 │
│ 静音检测: ☑️ 自动跳过静音片段             │
└─────────────────────────────────────────┘

```

### 2.4.4 转录设置

```
┌─────────────────────────────────────────┐
│ 转录设置                                  │
├─────────────────────────────────────────┤
│ 转录引擎                                  │
│ 当前模型: [whisper-base ▼]               │
│ [下载更多模型...] [管理本地模型...]       │
├─────────────────────────────────────────┤
│ 转录选项                                  │
│ 主要语言: [中文 ▼]                       │
│ 实时性: ────●──── (速度 ↔️ 准确性)        │
│ ☑️ 显示时间戳 ☑️ 显示置信度               │
├─────────────────────────────────────────┤
│ 本地模型管理                              │
│ • whisper-base (已下载) [删除]           │
│ • whisper-large (未下载) [下载]          │
└─────────────────────────────────────────┘

```

### 2.4.5 AI 设置

```
┌─────────────────────────────────────────┐
│ AI 设置                                  │
├─────────────────────────────────────────┤
│ 默认 AI 服务                             │
│ [○ OpenAI ○ Claude ○ Gemini]            │
├─────────────────────────────────────────┤
│ OpenAI 配置                              │
│ API Key: [sk-...] [测试连接]             │
│ 模型: [gpt-4 ▼]                         │
│ 温度: ────●──── 0.7                     │
├─────────────────────────────────────────┤
│ Claude 配置                              │
│ API Key: [未配置] [设置]                 │
│ 模型: [claude-3-sonnet ▼]               │
├─────────────────────────────────────────┤
│ Gemini 配置                              │
│ API Key: [未配置] [设置]                 │
│ 模型: [gemini-pro ▼]                    │
└─────────────────────────────────────────┘

```

## 3. macOS 特定功能

### 3.1 菜单栏集成

- **应用菜单**：[LazyAud.io](http://lazyaud.io/) > 关于、偏好设置、退出
- **文件菜单**：新建录制、打开历史、导出
- **编辑菜单**：复制、粘贴、查找
- **窗口菜单**：最小化、缩放
- **帮助菜单**：用户指南、快捷键

### 3.2 状态栏图标

- 显示录制状态
- 快速开始/停止录制
- 快速访问最近录制

### 3.3 权限处理

- **系统音频权限**：引导用户到系统偏好设置
- **麦克风权限**：标准权限请求对话框
- **文件访问权限**：沙盒文件访问

### 3.4 通知中心

- 录制开始/结束通知
- 转录完成通知
- AI 处理完成通知

### 3.5 快捷键支持

- `Cmd+R`：开始/停止录制
- `Cmd+T`：切换到转录页面
- `Cmd+H`：切换到历史页面
- `Cmd+,`：打开设置
- `Space`：播放/暂停音频

## 4. 窗口尺寸规范

### 4.1 主窗口

- **最小尺寸**：800 x 600
- **默认尺寸**：1000 x 700
- **最大尺寸**：不限制，支持全屏

### 4.2 设置窗口

- **固定尺寸**：600 x 500
- **模态窗口**：是

### 4.3 响应式设计

- 侧边栏最小宽度：200px
- 内容区域最小宽度：400px
- 支持窗口缩放时的布局调整

对于 macOS App，权限申请的最佳实践是这样的：

## macOS 权限申请策略

### 1. 麦克风权限 ✅

**可以在 Landing Page 申请**

- 这是标准的隐私权限
- 系统会显示标准权限对话框
- 用户可以允许/拒绝
- 可以在 `Info.plist` 中配置 `NSMicrophoneUsageDescription`

### 2. 系统音频录制权限 ⚠️

**需要特殊处理**

- 这不是标准权限对话框
- 需要用户手动到 **系统偏好设置 > 安全性与隐私 > 隐私 > 屏幕录制** 中添加你的 App
- 或者在 macOS Monterey+ 中，可能需要到 **系统设置 > 隐私与安全性 > 屏幕录制**

## 推荐的 Landing Page 权限流程

```
┌─────────────────────────────────────────┐
│ 🎉 欢迎使用 LazyAud.io                   │
├─────────────────────────────────────────┤
│ 为了正常使用，我们需要以下权限：           │
│                                         │
│ ✅ 麦克风访问权限                        │
│    用于录制您的语音输入                   │
│    [立即授权]                           │
│                                         │
│ 🔧 系统音频录制权限 (必需)               │
│    用于录制系统播放的音频                 │
│    [打开系统设置]                       │
│                                         │
│ 📝 权限设置说明：                        │
│ 1. 点击"打开系统设置"                    │
│ 2. 在"屏幕录制"中找到 LazyAud.io         │
│ 3. 勾选启用                             │
│ 4. 重启应用                             │
│                                         │
│ [跳过设置，稍后配置] [完成设置]          │
└─────────────────────────────────────────┘

```

## 代码实现建议

### 1. 麦克风权限检查

```swift
import AVFoundation

func requestMicrophonePermission() {
    AVAudioSession.sharedInstance().requestRecordPermission { granted in
        DispatchQueue.main.async {
            if granted {
                // 权限已授予
                self.updateMicrophoneStatus(true)
            } else {
                // 权限被拒绝
                self.showMicrophonePermissionDeniedAlert()
            }
        }
    }
}

```

### 2. 系统音频权限检查

```swift
import ScreenCaptureKit

func checkSystemAudioPermission() -> Bool {
    // 尝试获取可用的音频源
    // 如果失败，说明没有权限
    return SCShareableContent.canRecordSystemAudio
}

func openSystemPreferences() {
    let url = URL(string: "x-apple.systempreferences:com.apple.preference.security?Privacy_ScreenCapture")!
    NSWorkspace.shared.open(url)
}

```

## 更新后的 PRD - Landing Page

### Landing Page 设计

```
┌─────────────────────────────────────────┐
│           🎧 LazyAud.io                 │
│        实时音频转录助手                   │
├─────────────────────────────────────────┤
│ 权限设置向导                              │
│                                         │
│ 步骤 1/2: 麦克风权限                     │
│ ┌─────────────────────────────────────┐ │
│ │ 🎤 麦克风访问                        │ │
│ │ 用于录制您的语音和对话                │ │
│ │                                     │ │
│ │ 状态: ⚠️ 未授权                      │ │
│ │ [请求麦克风权限]                     │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ 步骤 2/2: 系统音频权限 (必需)            │
│ ┌─────────────────────────────────────┐ │
│ │ 🔊 系统音频录制                      │ │
│ │ 用于录制系统播放的音频内容            │ │
│ │                                     │ │
│ │ 状态: ❌ 需要手动设置                 │ │
│ │ [打开系统设置] [查看教程]             │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ [稍后设置] [权限设置完成，开始使用]       │
└─────────────────────────────────────────┘

```

### 权限状态管理

- **绿色 ✅**：权限已授予
- **黄色 ⚠️**：权限未请求
- **红色 ❌**：权限被拒绝或需要手动设置

### 用户体验优化

1. **智能检测**：App 启动时自动检测权限状态
2. **实时更新**：用户从系统设置返回时自动刷新状态
3. **跳过选项**：允许用户跳过权限设置，但会在功能使用时再次提醒
4. **教程指导**：提供图文教程指导用户完成系统音频权限设置

这样的设计既符合 macOS 的权限模型，又能提供良好的用户体验。